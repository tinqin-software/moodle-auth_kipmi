define(["core/ajax","core/notification"],function(e,t){var n=!0,a=0;return{init:function(i,s,c,o,r,u){var d=function(){if(!n||a>=150){a>=150&&(t.alert("",r),window.location.href=o);return}a++,e.call([{methodname:"auth_kipmi_check_auth_status",args:{sessionid:i},done:function(e){"success"===e.status?(n=!1,l(c,s,i)):"failed"===e.status?(n=!1,t.alert("",u),window.location.href=o):(e.status,setTimeout(d,2e3))},fail:function(){setTimeout(d,2e3)}}])},l=function(e,t,n){var a=document.createElement("form");a.method="POST",a.action=e;var i=document.createElement("input");i.type="hidden",i.name="state",i.value=t,a.appendChild(i);var s=document.createElement("input");s.type="hidden",s.name="sessionid",s.value=n,a.appendChild(s);var c=document.createElement("input");c.type="hidden",c.name="sesskey",c.value=M.cfg.sesskey,a.appendChild(c),document.body.appendChild(a),a.submit()};d()}}});
